# ===========================
# trans 服务端口
# ===========================
server:
  port: 28000   # trans 自己的 HTTP 端口（通常只是启动用，压测核心在主动发请求）


# ===========================
# 日志格式
# ===========================
logging:
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %logger{36} - %msg%n"
    # 控制台日志输出格式：
    # 时间 + 日志级别 + 线程名 + 类名 + 内容
    # 在压测中非常重要，可以看到线程变化和延迟


# ===========================
# trans 压测配置
# ===========================
trans:

  # push 服务地址
  pushUrl: "http://localhost:26000/push"
  # trans 发请求的目标地址
  # 可以改成产线 push 地址做真实模拟

  timeoutSeconds: 4
  # trans 等待 push 返回的超时时间
  # 超过这个时间会认为请求失败
  # 这个值必须 >= push 的业务超时时间（例如 push 3s 断开）


  # ============================================
  # 速率控制（令牌桶模型）
  # ============================================

  qps: 5
  # 平均 QPS（长期统计值）
  # 注意：这是“长期平均”
  # 实际瞬时 QPS 会因为 burst / pause / jitter 波动

  tokenRefillMs: 100
  # 令牌补充粒度（毫秒）
  # 每 100ms 补充一次令牌
  # 越小越平滑，但调度开销越大
  # 推荐范围：50~200ms

  tokenBucketCapacity: 20
  # 令牌桶最大容量
  # 决定最大“瞬时突发”能力
  # 如果太小，burst 时会被削平
  # 如果太大，会允许更猛烈的瞬时冲击


  # ============================================
  # 并发控制
  # ============================================

  concurrency: 100
  # 最大在途请求数
  # 使用 Semaphore 控制
  # 防止 trans 无限压垮 push
  # 实际在途 = min(concurrency, 当前令牌数)


  # ============================================
  # 非匀速模拟 - 抖动
  # ============================================

  jitterMsMax: 150
  # 每个请求发送前额外 sleep 0~150ms
  # 用于打散节奏
  # 模拟真实系统“并非严格等间隔”
  # 设置为 0 则完全关闭抖动


  # ============================================
  # 非匀速模拟 - 突发（Burst）
  # ============================================

  burst:
    enabled: true
    # 是否开启突发模式

    probabilityPerSecond: 0.10
    # 每秒触发一次突发的概率
    # 0.10 = 10%
    # 值越大，突发越频繁

    durationMsMin: 800
    # 突发持续时间最小值（毫秒）

    durationMsMax: 1800
    # 突发持续时间最大值（毫秒）
    # 实际持续时间为 [min, max] 随机值

    factorMin: 2.0
    # 突发期间 QPS 放大倍数的最小值

    factorMax: 4.0
    # 突发期间 QPS 放大倍数的最大值
    # 实际倍率为 [factorMin, factorMax] 随机值
    #
    # 举例：
    # 如果 qps=10
    # 突发期 QPS 可能在 20~40 之间


  # ============================================
  # 非匀速模拟 - 空窗（Pause）
  # ============================================

  pause:
    enabled: true
    # 是否开启空窗模式

    probabilityPerSecond: 0.06
    # 每秒 6% 概率进入一次“暂停发请求”阶段
    # 模拟“几秒一次请求”的感觉

    durationMsMin: 1200
    # 空窗持续时间最小值（毫秒）

    durationMsMax: 4500
    # 空窗持续时间最大值（毫秒）
    # 实际暂停时间在 [min, max] 之间随机
    #
    # 空窗期间 QPS = 0
